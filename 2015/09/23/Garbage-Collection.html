<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Garbage Collection - Jing Chen</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Garbage Collection">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Garbage Collection">
    <meta property="og:description" content="">

    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="/apple-touch-icon-precomposed.png" rel="apple-touch-icon">

    <link rel="stylesheet" type="text/css" href="//milantracy.github.io/themes/uno/assets/css/uno.css?v=1.0.0" />

    <link rel="canonical" href="https://milantracy.github.io/2015/09/23/Garbage-Collection.html" />
    
    <meta property="og:site_name" content="Jing Chen" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Garbage Collection" />
    <meta property="og:description" content="What is Automatic Garbage Collection? Automatic garbage collection is the process of looking at heap memory, identifying which objects are in use and which are not, and deleting the unused objects. So the memory used by an unreferenced object can..." />
    <meta property="og:url" content="https://milantracy.github.io/2015/09/23/Garbage-Collection.html" />
    <meta property="article:published_time" content="2015-09-23T07:00:00.000Z" />
    <meta property="article:modified_time" content="2015-10-19T19:36:16.415Z" />
    <meta property="article:tag" content="Java" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Garbage Collection" />
    <meta name="twitter:description" content="What is Automatic Garbage Collection? Automatic garbage collection is the process of looking at heap memory, identifying which objects are in use and which are not, and deleting the unused objects. So the memory used by an unreferenced object can..." />
    <meta name="twitter:url" content="https://milantracy.github.io/2015/09/23/Garbage-Collection.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Jing Chen",
    "author": {
        "@type": "Person",
        "name": "Jing Chen",
        "image": "https://avatars.githubusercontent.com/u/6878258?v=3",
        "url": "undefined/author/undefined",
        "sameAs": null
    },
    "headline": "Garbage Collection",
    "url": "https://milantracy.github.io/2015/09/23/Garbage-Collection.html",
    "datePublished": "2015-09-23T07:00:00.000Z",
    "dateModified": "2015-10-19T19:36:16.415Z",
    "keywords": "Java",
    "description": "What is Automatic Garbage Collection? Automatic garbage collection is the process of looking at heap memory, identifying which objects are in use and which are not, and deleting the unused objects. So the memory used by an unreferenced object can..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Jing Chen" href="https://milantracy.github.io/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">

</head>
<body class="post-template tag-Java no-js">

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    <header class="panel-cover panel-cover--collapsed " style="background-image: url(http://s1.thcdn.com/design-assets/products/10780752/b.jpg)">
      <div class="panel-main">
    
        <div class="panel-main__inner panel-inverted">
        <div class="panel-main__content">
    
            <h1 class="panel-cover__title panel-title"><a href="https://milantracy.github.io" title="link to homepage for Jing Chen">Jing Chen</a></h1>
            <hr class="panel-cover__divider" />
            <p class="panel-cover__description">Algorithms, Java &amp; Python, Backend Development</p>
            <hr class="panel-cover__divider panel-cover__divider--secondary" />
    
            <div class="navigation-wrapper">
    
              <nav class="cover-navigation cover-navigation--primary">
                <ul class="navigation">
                  <li class="navigation__item"><a href="https://milantracy.github.io/#blog" title="link to Jing Chen blog" class="blog-button">Blog</a></li>
                </ul>
              </nav>
    
              
              
              <nav class="cover-navigation navigation--social">
                <ul class="navigation">
              
                  <!-- Twitter -->
                  <li class="navigation__item">
                    <a href="https://www.facebook.com/profile.php?id=100006454394797" title="Facebook account">
                      <i class='icon icon-social-facebook'></i>
                      <span class="label">Facebook</span>
                    </a>
                  </li>
              
                  <!-- Twitter -->
                  <li class="navigation__item">
                    <a href="https://twitter.com/ChenCristiano?lang=en" title="Twitter account">
                      <i class='icon icon-social-twitter'></i>
                      <span class="label">Twitter</span>
                    </a>
                  </li>
              
              
                  <!-- Github -->
                  <li class="navigation__item">
                    <a href="https://github.com/milantracy" title="Github account">
                      <i class='icon icon-social-github'></i>
                      <span class="label">Github</span>
                    </a>
                  </li>
                  </li>
              
              
              
              
                  <!-- LinkedIn -->
                  <li class="navigation__item">
                    <a href="https://www.linkedin.com/pub/jing-chen/71/b60/363" title="LinkedIn account">
                      <i class='icon icon-social-linkedin'></i>
                      <span class="label">LinkedIn</span>
                    </a>
                  </li>
              
                  <!-- Email -->
                  <li class="navigation__item">
                    <a href="mailto:milantracy@gmail.com" title="Email milantracy@gmail.com">
                      <i class='icon icon-mail'></i>
                      <span class="label">Email</span>
                    </a>
                  </li>
              
                </ul>
              </nav>
              
    
            </div>
    
          </div>
    
        </div>
    
        <div class="panel-cover--overlay"></div>
      </div>
    </header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            

  <article class="post-container post-container--single">

    <header class="post-header">
      <div class="post-meta">
        <time datetime="23 Sep 2015" class="post-meta__date date">23 Sep 2015</time> &#8226; <span class="post-meta__tags tags">on <a href="https://milantracy.github.io/tag/Java">Java</a></span>
        <span class="post-meta__author author"><img src="https://avatars.githubusercontent.com/u/6878258?v=3" alt="profile image for Jing Chen" class="avatar post-meta__avatar" /> by Jing Chen</span>
      </div>
      <h1 class="post-title">Garbage Collection</h1>
    </header>

    <section class="post tag-Java">
      <div id="preamble">
<div class="sectionbody">
<hr>
</div>
</div>
<div class="sect3">
<h4 id="_what_is_automatic_garbage_collection">What is Automatic Garbage Collection?</h4>
<div class="paragraph">
<p>Automatic garbage collection is the process of looking at <strong>heap</strong> memory, identifying which objects are in use and which are not, and deleting the unused objects. So the memory used by an unreferenced object can be <strong>reclaimed</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <strong>in use object</strong>, or <strong>a referenced object</strong>, means that some part of your program still maintains a pointer to that object.</p>
</li>
<li>
<p><strong>An unused object</strong>, or <strong>unreferenced object</strong>, is no longer referenced by any part of your program.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Java, process of deallocating memory is handled automatically by the <strong>garbage collector</strong>. The basic process can be described as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Marking</p>
<div class="ulist">
<ul>
<li>
<p>This is where the garbage collector identifies which pieces of memory are in use and which are not. All objects are scanned in the marking phase to make this determination. This can be a very <strong>time consuming</strong> process if all objects in a system must be scanned.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide3.png" alt="Slide3.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Normal Deletion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Normal deletion removes <strong>unreferenced objects</strong> leaving referenced objects and pointers to free space. The memory allocator holds references to blocks of free space where new object can be allocated.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide1b.png" alt="Slide1b.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Deletion with Compacting
To further improve performance, in addition to deleting unreferenced objects, you can also compact the remaining referenced objects. By moving referenced object together, this makes new memory allocation much easier and faster.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide4.png" alt="Slide4.png">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generational_garbage_collection">Generational Garbage Collection?</h4>
<div class="paragraph">
<p>As stated earlier, having to mark and compact all the objects in a JVM is inefficient. As more and more objects are allocated, the list of objects grows and grows leading to longer and longer garbage collection time. However, empirical analysis of applications has shown that <strong>most objects are short lived</strong>.</p>
</div>
<div class="paragraph">
<p>The heap is broken up into smaller parts or generations.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Young Generation</strong></p>
<div class="ulist">
<ul>
<li>
<p>The Young Generation is where all <strong>new objects are allocated and aged</strong>. When the young generation fills up, this causes a <strong>minor garbage collection</strong>. Minor collections can be optimized assuming a high object mortality rate. A young generation full of dead objects is collected very quickly. Some surviving objects are aged and eventually move to the old generation.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Old or Tenured Generation</strong></p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Old Generation</strong> is used to store <strong>long surviving objects</strong>. Typically, a threshold is set for young generation object and when that age is met, the object gets moved to the old generation. Eventually the old generation needs to be collected when the old generation fills up. This event is called a <strong>major garbage collection</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Permanent Generation</strong>.</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Permanent generation</strong> contains metadata required by the JVM to describe the classes and methods used in the application. The permanent generation is populated by the JVM at runtime based on classes in use by the application. In addition, Java SE library classes and methods may be stored here.</p>
</li>
<li>
<p>Classes may get collected (unloaded) if the JVM finds they are no longer needed and space may be needed for other classes. The permanent generation is included in a <strong>full garbage collection</strong>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide5.png" alt="Slide5.png">
</div>
</div>
<div class="paragraph">
<p><strong>Stop the World Event</strong> - All <strong>minor garbage collections</strong> are "Stop the World" events. This means that all application threads are stopped until the operation completes. Minor garbage collections are always Stop the World events.</p>
</div>
<div class="paragraph">
<p><strong>Major garbage collection</strong> are also <strong>Stop the World events</strong>. Often a major collection is much slower because it <strong>involves all live objects</strong>. Major garbage collections should be minimized.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Also note, that the length of the Stop the World event for a major garbage collection is affected by the kind of garbage collector that is used for the old generation space.</pre>
</div>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_generational_garbage_collection_2">Generational Garbage Collection</h3>
<div class="ulist">
<ul>
<li>
<p>First, any new objects are allocated to the <strong>eden space</strong>. Both survivor spaces start out empty.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide13.png" alt="Slide13.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When the eden space fills up, a <strong>minor garbage collection</strong> is triggered.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide14.png" alt="Slide14.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Referenced objects are moved to the first <strong>survivor space</strong>. Unreferenced objects are deleted when the eden space is cleared.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide6.png" alt="Slide6.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>At the next minor GC, the same thing happens for the eden space. Unreferenced objects are deleted and referenced objects are moved to a survivor space. However, in this case, they are moved to the second survivor space (S1). In addition, <strong>objects from the last minor GC</strong> on the first survivor space (S0) have their <strong>age incremented</strong> and get moved to S1. Once all surviving objects have been moved to S1, both <strong>S0 and eden</strong> are cleared. Notice we now have differently aged object in the survivor space.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide8.png" alt="Slide8.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>At the next minor GC, the same process repeats. However this time the survivor spaces switch. Referenced objects are moved to S0. Surviving objects are aged. Eden and S1 are cleared.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide9.png" alt="Slide9.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>After a minor GC, when aged objects reach a <strong>certain age threshold</strong> (8 in this example) they are promoted from young generation to old generation.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide7.png" alt="Slide7.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>As minor GCs continue to occure objects will continue to be promoted to the old generation space.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide10.png" alt="Slide10.png">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>So that pretty much covers the entire process with the young generation. Eventually, a <strong>major GC</strong> will be performed on the old generation which cleans up and compacts that space.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/images/gcslides/Slide11.png" alt="Slide11.png">
</div>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_java_garbage_collector">Java Garbage Collector</h3>
<div class="ulist">
<ul>
<li>
<p>-Xms : Sets the initial heap size for when the JVM starts.</p>
</li>
<li>
<p>-Xmx : Sets the maximum heap size.</p>
</li>
<li>
<p>-Xmn : Sets the size of the Young Generation.</p>
</li>
<li>
<p>-XX:PermSize	Sets the starting size of the Permanent Generation.</p>
</li>
<li>
<p>-XX:MaxPermSize	Sets the maximum size of the Permanent Generation</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_the_serial_gc">The serial GC</h4>
<div class="paragraph">
<p>The <strong>serial collector</strong> is the default for client style machines in Java SE 5 and 6. With the serial collector, both minor and major garbage collections are done <strong>serially</strong> (using a single virtual CPU). In addition, it uses a mark-compact collection method. This method moves older memory to the beginning of the heap so that new memory allocations are made into a single continuous chunk of memory at the end of the heap. This compacting of memory makes it faster to allocate new chunks of memory to the heap.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use Case</p>
<div class="ulist">
<ul>
<li>
<p>Do not have low pause time requirements</p>
</li>
<li>
<p>client-style machines</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another popular use for the Serial GC is in environments where a <strong>high number of JVMs are run on the same machine</strong> (in some cases, more JVMs than available processors!). In such environments when a JVM does a garbage collection it is better to use only one processor to minimize the interference on the remaining JVMs, even if the garbage collection might last longer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>-XX:+UseSerialGC</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_parallel_gc">The Parallel GC</h4>
<div class="paragraph">
<p>The parallel garbage collector uses <strong>multiple threads</strong> to perform the young genertion garbage collection. By default on a host with N CPUs, the parallel garbage collector uses N garbage collector threads in the collection. The number of garbage collector threads can be controlled with command-line options</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use Case</p>
<div class="ulist">
<ul>
<li>
<p>a lot of work need to be done</p>
</li>
<li>
<p>long pauses are acceptable</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Parallel collector is also called a throughput collector. Since it can use multilple CPUs to speed up application throughput.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>-XX:+UseParallelGC</code></pre>
</div>
</div>
<div class="paragraph">
<p>the command only requires parallel GC for the minor GC</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_concurrent_mark_sweep_cms_collector">The Concurrent Mark Sweep (CMS) Collector</h4>
<div class="paragraph">
<p>The Concurrent Mark Sweep (CMS) collector (also referred to as the concurrent low pause collector) collects the <strong>tenured generation</strong>. It attempts to minimize the pauses due to garbage collection by doing most of the garbage collection work concurrently with the application threads. Normally the concurrent low pause collector <strong>does not copy or compact</strong> the live objects. A garbage collection is done without moving the live objects. If fragmentation becomes a problem, allocate a larger heap.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use Case</p>
<div class="ulist">
<ul>
<li>
<p>require low pause times</p>
</li>
<li>
<p>can share resources with the garbage collector.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_the_g1_garbage_collector">The G1 Garbage Collector</h4>
<div class="paragraph">
<p>The G1 collector is a <strong>parallel</strong>, <strong>concurrent</strong>, and <strong>incrementally compacting</strong> low-pause garbage collector that has quite a different layout from the other garbage collectors described previously.</p>
</div>
</div>
</div>
    </section>

  </article>




            <footer class="footer">
                <span class="footer__copyright">&copy; 2015. All rights reserved.</span>
                <span class="footer__copyright"><a href="http://uno.daleanthony.com" title="link to page for Uno Ghost theme">Uno theme</a> by <a href="http://daleanthony.com" title="link to website for Dale-Anthony">Dale-Anthony</a></span>
                <span class="footer__copyright">Proudly published with <a href="http://hubpress.io" title="link to Hubpress website">Hubpress</a></span>
            </footer>
        </div>
    </div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>

    <script type="text/javascript" src="//milantracy.github.io/themes/uno/assets/js/main.js?v=1.0.0"></script>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-67853404-1', 'auto');
    ga('send', 'pageview');

    </script>

</body>
</html>
